import{r as c,j as t,S as p,y as w,a as R}from"./index-C8JFuZlv.js";import{u as j,F as C,a as b,b as v,d as N,e as y}from"./index-D7zi7Ntn.js";import{I as k}from"./index-DFQufHV3.js";import{W as I,M as P,H as A}from"./useMetadata-D7nd75QV.js";function F({placeholder:n="검색어를 입력하세요",initialValue:s="",onSubmit:a,onClear:u,autoFocus:m=!1}){const o=c.useRef(null),e=j({defaultValues:{search:s}});c.useEffect(()=>{e.setValue("search",s)},[s,e]);const r=i=>{i.search.trim()!==""&&a(i.search)},l=()=>{e.setValue("search",""),o.current&&o.current.focus(),u&&u()};return t.jsx("div",{className:"relative w-full",children:t.jsx(C,{...e,children:t.jsxs("form",{onSubmit:e.handleSubmit(r),className:"w-full",children:[t.jsx(b,{control:e.control,name:"search",render:({field:i})=>t.jsxs(v,{className:"w-full",children:[t.jsx(N,{children:t.jsx(k,{placeholder:n,className:"w-full py-1.5 pl-9 pr-9 text-sm font-normal text-primary-dark01",...i,ref:S=>{o.current=S,i.ref(S)},autoFocus:m})}),t.jsx(y,{})]})}),t.jsx("img",{src:p.SEARCH,alt:"돋보기",width:17,height:17,className:"absolute left-3 top-2 z-10 opacity-30"}),e.watch("search")&&t.jsx("button",{type:"button",onClick:l,className:"absolute right-3 top-2 z-10 flex h-4 w-4 items-center justify-center rounded-full bg-primary-normal01","aria-label":"검색어 초기화",children:t.jsx("img",{src:p.CANCEL,alt:"X 아이콘",width:12,height:12,className:"opacity-30"})})]})})})}function M({children:n,title:s="검색",placeholder:a="검색어를 입력하세요",searchValue:u="",onSearchSubmit:m,onSearchClear:o,onBackButtonClick:e}){return t.jsxs(I,{bg:"white",children:[t.jsx(P,{title:s,description:"유치원 교사들을 위한 유치원 리뷰 및 커뮤니티 서비스"}),t.jsx(A,{hasBackButton:!0,hasBorder:!1,onBackButtonClick:e,titleElement:t.jsx(F,{placeholder:a,initialValue:u,onSubmit:m,onClear:o,autoFocus:!0})}),t.jsx("div",{className:"mt-14 flex-1 overflow-hidden",children:n})]})}const d="recentSearches",L=8,f="recentSearchesUpdate";function E(){const[n,s]=c.useState([]),a=c.useCallback(()=>{try{const e=localStorage.getItem(d);if(e){const r=JSON.parse(e);return s(r),r}return[]}catch(e){return console.error("최근 검색어 불러오기 실패:",e),[]}},[]);c.useEffect(()=>{a()},[a]),c.useEffect(()=>{const e=r=>{r.key===d&&a()};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[a]),c.useEffect(()=>{const e=()=>{a()};return window.addEventListener(f,e),()=>{window.removeEventListener(f,e)}},[a]);const u=c.useCallback(e=>{if(!(!e||e.trim()===""))try{const r=JSON.parse(localStorage.getItem(d)||"[]"),l=[e,...r.filter(i=>i!==e)].slice(0,L);localStorage.setItem(d,JSON.stringify(l)),s(l),window.dispatchEvent(new CustomEvent(f))}catch(r){console.error("최근 검색어 저장 실패:",r)}},[]),m=c.useCallback(e=>{try{const l=JSON.parse(localStorage.getItem(d)||"[]").filter(i=>i!==e);localStorage.setItem(d,JSON.stringify(l)),s(l),window.dispatchEvent(new CustomEvent(f))}catch(r){console.error("최근 검색어 삭제 실패:",r)}},[]),o=c.useCallback(()=>{try{localStorage.removeItem(d),s([]),window.dispatchEvent(new CustomEvent(f))}catch(e){console.error("최근 검색어 전체 삭제 실패:",e)}},[]);return{recentSearches:n,addRecentSearch:u,removeRecentSearch:m,clearAllRecentSearches:o}}function V({onSelectQuery:n}){const{recentSearches:s,removeRecentSearch:a,clearAllRecentSearches:u}=E(),m=e=>{n(e)},o=(e,r)=>{r.stopPropagation(),a(e)};return t.jsxs("section",{className:"mb-6 flex h-full flex-col gap-5 overflow-y-auto px-6 py-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsx("h1",{className:"font-semibold text-primary-dark01",children:"최근 검색어"}),s.length>0&&t.jsx("button",{onClick:u,"aria-label":"검색어 전체 삭제",className:"font-semibold text-primary-normal03 hover:opacity-70",children:"전체삭제"})]}),s.length===0?t.jsx("p",{className:"py-20 text-center text-sm text-primary-normal03",children:"최근 검색어가 없습니다."}):t.jsx("ul",{className:"flex flex-col gap-5",children:s.map((e,r)=>t.jsxs("li",{className:"flex items-center justify-between",children:[t.jsx("button",{onClick:()=>m(e),className:"text-sm text-primary-dark01 hover:opacity-70","aria-label":`${e} 검색`,children:e}),t.jsx("button",{onClick:l=>o(e,l),className:"ml-1 text-xs text-gray-400 hover:text-gray-600","aria-label":"검색어 삭제",children:t.jsx("img",{src:p.CANCEL,alt:"X 아이콘",width:18,height:18})})]},`${e}-${r}`))})]})}function X(n="query"){const[s,a]=w(),u=R(),{addRecentSearch:m}=E(),[o,e]=c.useState(s.get(n)||""),[r,l]=c.useState(!0);c.useEffect(()=>{const h=s.get(n)||"";e(h)},[s,n]),c.useEffect(()=>{r&&l(!1)},[r]);const i=()=>{u(-1)},S=h=>{h.trim()&&(a(x=>{const g=new URLSearchParams(x);return g.set(n,h),g},{replace:!0}),m(h))};return{searchQuery:o,isInitialRender:r,handleBackClick:i,handleSearchSubmit:S,handleClearSearch:()=>{a(h=>{const x=new URLSearchParams(h);return x.delete(n),x},{replace:!0})},handleRecentSearchSelect:h=>{S(h)},isSearchResult:h=>!!(o&&h.length>0)}}export{V as R,M as S,X as u};
