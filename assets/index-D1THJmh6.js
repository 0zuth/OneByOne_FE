import{j as a,r as u,U as p,b as h}from"./index-C8JFuZlv.js";import{u as f}from"./useMetadata-D7nd75QV.js";import{E as x}from"./index-Bz5g5oRx.js";import{E as g}from"./index-BJS9H4xq.js";import{P as E}from"./index-DR008vrG.js";import{c as j,K as S,a as b}from"./KindergartenMapMarker-BFxQ0Mnp.js";import{S as L}from"./index-DUOfRk2D.js";import{s as N,M as w}from"./webViewCommunication-_xI12zLs.js";import{g as y}from"./kindergartenService-Cv6rNABr.js";import"./useMutation-B4GGscfX.js";import"./index-YwY8NhB0.js";function T({latitude:s,longitude:o,className:l="",kindergartens:r=[]}){const t=j({latitude:s,longitude:o},r.map(e=>({latitude:e.latitude,longitude:e.longitude})));return a.jsx(S,{latitude:s,longitude:o,level:t,height:"h-80",className:l,showUserLocation:!0,children:r.map(e=>a.jsx(b,{latitude:e.latitude,longitude:e.longitude,name:e.name,establishment:e.establishment,size:"md",onClick:()=>{window.location.href=`/school/${e.id}`}},e.id))})}function M(s){switch(s.code){case s.PERMISSION_DENIED:return"위치 정보 접근 권한이 거부되었습니다. 위치 권한을 확인해주세요.";case s.POSITION_UNAVAILABLE:return"현재 위치 정보를 사용할 수 없습니다.";case s.TIMEOUT:return"요청 시간이 초과되었습니다.";default:return"알 수 없는 오류가 발생했습니다."}}function v(s){const[o,l]=u.useState({loading:!0,error:null,position:null});return u.useEffect(()=>{if(/OneByOne/i.test(navigator.userAgent)){let t=!0;return l(e=>({...e,loading:!0})),N(w.REQUEST_LAT_LONG,{}).then(e=>{t&&(e.status==="true"&&e.lat&&e.long?l({loading:!1,error:null,position:{latitude:parseFloat(e.lat),longitude:parseFloat(e.long)}}):l({loading:!1,error:e.error||e.message||"위치 정보를 가져오는데 실패했습니다.",position:null}))}).catch(e=>{t&&l({loading:!1,error:e instanceof Error?e.message:"위치 정보를 가져오는데 실패했습니다.",position:null})}),()=>{t=!1}}else{if(!navigator.geolocation){l({loading:!1,error:"이 브라우저에서는 위치 정보를 지원하지 않습니다.",position:null});return}const t=n=>{l({loading:!1,error:null,position:{latitude:n.coords.latitude,longitude:n.coords.longitude}})},e=n=>{l({loading:!1,error:M(n),position:null})},c=navigator.geolocation.watchPosition(t,e,s);return()=>{navigator.geolocation.clearWatch(c)}}},[s]),o}function R(){const s=u.useMemo(()=>({enableHighAccuracy:!0,timeout:1e4,maximumAge:6e5}),[]),{position:o,loading:l,error:r}=v(s),{data:t,isLoading:e,error:c}=f({queryKey:["kindergartens","nearby",o==null?void 0:o.latitude,o==null?void 0:o.longitude],queryFn:()=>y({latitude:o.latitude,longitude:o.longitude}),enabled:!!o,staleTime:1e3*60*10,gcTime:1e3*60*30}),n=t!=null&&t.success&&(t!=null&&t.data)?t.data:[],m=l||!!o&&e,d=r||(c instanceof g?c.message:null)||(t&&!t.success?t.message:null);return a.jsx(E,{title:"원바원 | 기관 찾기",description:"지도와 검색을 통해 기관 찾기",headerType:"school",headerLogo:!0,currentPath:p.SCHOOL,mainBg:"gray",hasBackButton:!1,children:m?a.jsx(h,{}):d?a.jsx(g,{type:"page",children:d}):a.jsxs(a.Fragment,{children:[a.jsx("section",{className:"flex flex-col gap-3 p-5",children:a.jsx(T,{latitude:o.latitude,longitude:o.longitude,kindergartens:n.map(i=>({id:i.id,name:i.name,latitude:i.latitude,longitude:i.longitude,establishment:i.establishment}))})}),a.jsxs("section",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1 px-5 font-bold",children:[a.jsx("h2",{className:"text-lg",children:"주변 유치원"}),a.jsx("span",{className:"text-xs",children:n.length>0&&`(${n.length})`})]}),n.length===0?a.jsx(x,{title:"주변 유치원을 찾을 수 없습니다.",subTitle:"위치 정보를 확인해주세요."}):a.jsx("ul",{className:"flex flex-col gap-2 pb-5",children:n.map(i=>a.jsx(L,{id:i.id.toString(),schoolName:i.name,location:i.address,establishment:i.establishment,workReviewAggregate:i.workReviewAggregate},i.id))})]})]})})}export{R as default};
