import{y as E,x as A,j as t,b as j,S as g,r as l,a as L}from"./index-C8JFuZlv.js";import{P as $}from"./index-Bn_EOjrQ.js";import{B as I,P as O}from"./index-DR008vrG.js";import{N as z}from"./index-WMVJUL97.js";import{d as w}from"./useMetadata-D7nd75QV.js";import{E as R}from"./index-Bz5g5oRx.js";import{P as S}from"./PostCard-NWLzrmGp.js";import{u as q,a as B}from"./useCommunity-BolemDNT.js";import{g as T,P as M,T as V}from"./categoryUtils-zncHimf5.js";import{u as _}from"./index-DFoBqv4q.js";import{F as k}from"./index.esm-CCktejdI.js";import{s as W}from"./scroll.module-BdLMzxx7.js";import"./useMutation-B4GGscfX.js";import"./index-YwY8NhB0.js";import"./index-Dea53TQG.js";import"./dateUtils-Br-z8UuZ.js";import"./useSuspenseInfiniteQuery-BdZRK4nz.js";import"./infiniteQueryObserver-CmTYH24f.js";import"./query-config-BQJB0S96.js";function F({type:r,categoryOptions:n}){const[e,s]=E(),i=A(),c=e.get("category")||"top10",m=a=>{if(a===c)return;const u=new URLSearchParams(e);if(u.set("category",a),u.set("type",r),s(u),w({path:`/community?type=${r}&category=${a}`,category:r,communityCategoryName:a}),a==="all"||a!=="top10"){const h={pageSize:10,category:r==="teacher"?"TEACHER":"PROSPECTIVE_TEACHER",categoryName:a!=="all"?a:void 0};i.refetchQueries({queryKey:["communityPosts",h],exact:!1})}else a==="top10"&&i.refetchQueries({queryKey:["popularPosts"]})};return t.jsx("section",{className:"scrollbar-x-hidden flex w-full gap-2 overflow-x-auto whitespace-nowrap",children:n.map(a=>t.jsx(I,{shape:"full",font:"md",size:"lg",variant:c===a.value?"secondary":"default",onClick:()=>m(a.value),children:a.label},a.value))})}function G(){const{data:r,isLoading:n}=q(),e=(r==null?void 0:r.data)||[];return n?t.jsx(j,{type:"element"}):t.jsxs("section",{className:"mb-12 flex flex-col gap-9 pb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("img",{src:g.CHART,alt:"그래프",width:"20",height:"18"}),t.jsx("h2",{className:"text-lg font-semibold",children:"실시간 인기 게시글"})]}),e.length===0?t.jsx(R,{title:"게시글이 없습니다.",subTitle:"첫 번째 게시글을 작성해보세요!"}):t.jsx("ul",{className:"flex flex-col gap-5",children:e.map((s,i)=>t.jsx(S,{post:s,index:i,currentCategory:"top10",getCategoryLabel:T},`post-${s.id}-${i}`))})]})}const K=({index:r,style:n,data:e})=>{const{posts:s,currentCategory:i,lastItemRef:c}=e,m=s[r],a=r===s.length-1;return m?t.jsx("div",{style:n,ref:a&&c?c:null,children:t.jsx(S,{post:m,index:r,currentCategory:i,getCategoryLabel:T})}):null};function U({type:r,categoryName:n,searchQuery:e="",searchType:s="title"}){const i=l.useRef(null),[c,m]=l.useState(window.innerHeight-200),[a,u]=l.useState("100%"),{ref:h,inView:d}=_({threshold:.1,rootMargin:"0px 0px 200px 0px"}),v=l.useMemo(()=>{const o={};return n!=="all"&&(o.categoryName=n),e&&(s==="title"?o.title=e:o.content=e),o},[n,e,s]),{data:f,isLoading:N,hasNextPage:x,fetchNextPage:y,isFetchingNextPage:C}=B(10,r==="teacher"?"TEACHER":"PROSPECTIVE_TEACHER",v);l.useEffect(()=>{const o=()=>{m(window.innerHeight-270),i.current&&u(i.current.clientWidth)};return o(),window.addEventListener("resize",o),setTimeout(()=>{i.current&&u(i.current.clientWidth)},0),()=>window.removeEventListener("resize",o)},[]),l.useEffect(()=>{d&&x&&!C&&y()},[d,x,C,y]);const H=(f==null?void 0:f.pages.flatMap(o=>o.content||[]))||[],p=Array.from(new Map(H.map(o=>[o.id,o])).values());if(N)return t.jsx(j,{type:"element"});if(p.length===0)return t.jsx(R,{title:"게시글이 없습니다.",subTitle:"첫 번째 게시글을 남겨보세요!"});const P=124,b=Math.min(p.length*P,c);return t.jsxs("section",{ref:i,children:[e&&t.jsxs("div",{className:"mb-4 text-sm text-primary-normal03",children:[p.length,"개의 검색 결과"]}),t.jsx(k,{height:b,width:a,itemCount:p.length,itemSize:P,itemData:{posts:p,currentCategory:n,lastItemRef:h},className:W["scrollbar-hide"],children:K})]})}const J=[{href:"/community?type=teacher",label:"교사",icon:{path:g.CHARACTER.chicken,alt:"교사 아이콘",width:32,height:32}},{href:"/community?type=pre-teacher",label:"예비교사",icon:{path:g.CHARACTER.chick,alt:"예비교사 아이콘",width:32,height:32}}];function ft(){const[r]=E(),n=L(),e=r.get("type")==="pre-teacher"?"pre-teacher":"teacher",s=r.get("category")||"top10",i=e==="pre-teacher"?M:V;return l.useEffect(()=>{const c={path:`/community?type=${e}&category=${s}`,category:e,communityCategoryName:s};w(c)},[e,s]),t.jsxs(O,{title:`원바원 | ${e==="teacher"?"교사":"예비교사"} 커뮤니티`,headerLogo:!0,headerType:"community",description:"유치원 교사와 예비교사를 위한 커뮤니티",currentPath:`/community?type=${e}&category=${s}`,mainClassName:"flex flex-col gap-6 pb-0 mt-14",hasBackButton:!1,children:[t.jsx(z,{options:J,currentPath:`/community?type=${e}&category=${s}`}),t.jsxs("div",{className:"flex w-full flex-col gap-9 px-5",children:[t.jsx(F,{type:e,categoryOptions:i}),s==="top10"?t.jsx(G,{}):t.jsx(U,{type:e,categoryName:s})]}),t.jsx($,{onClick:()=>n("/community/new"),label:"글쓰기"})]})}export{ft as default};
