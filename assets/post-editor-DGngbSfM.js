import{r as o,a as k,j as t,U as _,b as w}from"./index-C8JFuZlv.js";import{s as D}from"./types-CfV6Q2Fg.js";import{u as F,F as O,a as u,b as d,c as g,d as y}from"./index-D7zi7Ntn.js";import{P as L,B as p}from"./index-DR008vrG.js";import{E as f}from"./index-Bv8WoFpc.js";import{I as B}from"./index-DFQufHV3.js";import{T as I}from"./index-CIl45rHz.js";import{i as R}from"./useCommunity-BolemDNT.js";import{a as x,b as A}from"./categoryUtils-zncHimf5.js";import{e as H,f as M,h,i as C}from"./useMetadata-D7nd75QV.js";import{P as U,a as z,b as G}from"./validationSchemas-CFCrOTP5.js";import"./useSuspenseInfiniteQuery-BdZRK4nz.js";import"./infiniteQueryObserver-CmTYH24f.js";import"./useMutation-B4GGscfX.js";import"./query-config-BQJB0S96.js";function le(){const n=o.useRef(!1),[s,X]=o.useState(()=>H()||"TEACHER"),[i,c]=o.useState(()=>{const e=M();return x(e,s)}),j=k(),{mutate:N,isPending:m}=R(),a=F({resolver:D(G),defaultValues:{title:"",content:"",category:s,communityCategoryName:i},mode:"onChange"}),{formState:b}=a,T=a.watch("title"),v=a.watch("content");o.useEffect(()=>{const e=a.getValues("communityCategoryName"),r=x(e,s);r!==e&&(c(r),a.setValue("communityCategoryName",r)),a.setValue("category",s),h(s),r!==e&&C(r)},[s,a]);const E=o.useCallback((e,r)=>{r.preventDefault(),r.stopPropagation(),c(e),a.setValue("communityCategoryName",e,{shouldDirty:!0,shouldValidate:!1}),a.getValues("category")!==s&&a.setValue("category",s,{shouldDirty:!0,shouldValidate:!1}),h(s),C(e)},[s,a]),P=o.useCallback(e=>{e.preventDefault(),e.stopPropagation(),!n.current&&a.handleSubmit(S)(e)},[a]),S=async e=>{if(n.current||m)return;n.current=!0;const r={title:e.title,content:e.content,category:e.category,communityCategoryName:e.communityCategoryName,communityCategoryDescription:e.category==="TEACHER"?"교사 커뮤니티":"예비교사 커뮤니티"};N(r,{onSuccess:()=>{j(-1)},onSettled:()=>{n.current=!1}})},V=A(s);return t.jsx(L,{title:"원바원 | 커뮤니티",headerTitle:" ",description:"커뮤니티 게시글 작성",currentPath:_.COMMUNITY_POST_EDITOR,mainClassName:"flex flex-col gap-6 pb-0 mt-14 mb-28",hasBackButton:!0,wrapperBg:"white",children:m?t.jsx(w,{}):t.jsxs("section",{className:"flex flex-col gap-5 p-5",children:[t.jsx("h2",{className:"text-base font-semibold text-primary-dark01",children:"카테고리"}),t.jsx(O,{...a,children:t.jsxs("form",{onSubmit:e=>e.preventDefault(),className:"space-y-6",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:V.map(e=>t.jsx(p,{variant:i===e.value?"secondary":"default",size:"lg",font:"md",shape:"full",onClick:r=>E(e.value,r),type:"button",className:"font-normal",children:e.label},e.value))}),t.jsx(u,{control:a.control,name:"title",render:({field:e,fieldState:r})=>{var l;return t.jsxs(d,{children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx(g,{className:"text-base font-semibold text-primary-dark01",children:"제목"}),t.jsxs("span",{className:"text-xs font-semibold text-primary-normal02",children:["*",T.length,"/",U,"자"]})]}),t.jsx(y,{children:t.jsx(B,{font:"md",placeholder:"제목을 입력해주세요",...e,error:!!r.error})}),((l=r.error)==null?void 0:l.message)&&t.jsx(f,{error:r.error.message})]})}}),t.jsx(u,{control:a.control,name:"content",render:({field:e,fieldState:r})=>{var l;return t.jsxs(d,{children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx(g,{className:"text-base font-semibold text-primary-dark01",children:"내용"}),t.jsxs("span",{className:"text-xs font-semibold text-primary-normal02",children:["*",v.length,"/",z,"자"]})]}),t.jsx(y,{children:t.jsx(I,{font:"md",padding:"sm",placeholder:`자유롭게 내용을 작성해주세요. 
                        
• 불편할 수 있는 비속어 사용은 피해 주세요. 
• 상세하고 유익한 정보 공유는 좋지만, 사생활 침해나 명예훼손이 없도록 조심해주세요. 
• 커뮤니티 에티켓을 지키지 않으면 글이 삭제될 수 있어요.`,...e,error:!!r.error})}),((l=r.error)==null?void 0:l.message)&&t.jsx(f,{error:r.error.message})]})}}),t.jsx("div",{className:"mt-4 flex justify-end gap-3",children:t.jsx(p,{variant:"secondary",size:"md",type:"button",onClick:P,disabled:m||n.current||!b.isValid,children:m?"등록 중...":"등록"})})]})})]})})}export{le as default};
