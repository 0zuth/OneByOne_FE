import{j as t,r as o,y as M,a as R,v as b,U as w}from"./index-C8JFuZlv.js";import{u as I,S as L,R as T}from"./useSearchPage-DBi74EYz.js";import{F as H}from"./index.esm-CCktejdI.js";import{P as E}from"./PostCard-NWLzrmGp.js";import{g as z}from"./categoryUtils-zncHimf5.js";import{s as O}from"./scroll.module-BdLMzxx7.js";import{a as U}from"./useCommunity-BolemDNT.js";import{c as A}from"./useMetadata-D7nd75QV.js";import"./index-D7zi7Ntn.js";import"./index-DFQufHV3.js";import"./index-YwY8NhB0.js";import"./index-Dea53TQG.js";import"./dateUtils-Br-z8UuZ.js";import"./useSuspenseInfiniteQuery-BdZRK4nz.js";import"./infiniteQueryObserver-CmTYH24f.js";import"./useMutation-B4GGscfX.js";import"./query-config-BQJB0S96.js";function B({item:a,onClick:r,ref:s,index:e=0}){return t.jsx("div",{onClick:r,className:"cursor-pointer",ref:s,children:t.jsx(E,{post:a,index:e,currentCategory:a.categoryName,getCategoryLabel:z})})}const Y=({index:a,style:r,data:s})=>{const e=s.items[a];return e?t.jsx("div",{style:r,children:t.jsx("div",{onClick:()=>s.onItemClick(e.id.toString()),className:"cursor-pointer py-1",children:t.jsx(B,{item:e,onClick:()=>s.onItemClick(e.id.toString()),ref:null,index:a})})}):null};function _({searchQuery:a,results:r,totalItems:s,isFetchingNextPage:e,hasNextPage:m,fetchNextPage:h,onPostClick:d}){const[S,C]=o.useState(()=>typeof window<"u"?window.innerHeight-120:680),c=124,u=Math.min(r.length*c,S),p=Math.floor(r.length*.8);o.useEffect(()=>{const n=()=>{C(window.innerHeight-120)};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]);const l=o.useCallback(n=>{d(n)},[d]),f=o.useCallback(()=>{!e&&m&&h()},[e,m,h]),y=o.useCallback(({overscanStopIndex:n,visibleStopIndex:j})=>{j>p&&n>=r.length-5&&f()},[r.length,p,f]);return a?t.jsxs("div",{className:"flex flex-col gap-2 pt-4",children:[t.jsx("div",{className:"px-5",children:t.jsxs("h3",{className:"text-sm font-semibold text-primary-dark01",children:["총 ",s>0&&`${s}`,"개의 검색 결과"]})}),t.jsxs("section",{className:"bg-white px-5 pt-4",children:[t.jsx(H,{height:u,width:"100%",itemCount:r.length,itemSize:c,onItemsRendered:y,overscanCount:5,itemData:{items:r,onItemClick:l},className:O["scrollbar-hide"],children:Y}),e&&t.jsx("div",{className:"h-2 w-full"})]})]}):null}function ne(){const[a]=M(),r=R(),s=b(),{searchQuery:e,isInitialRender:m,handleSearchSubmit:h,handleClearSearch:d,handleRecentSearchSelect:S,isSearchResult:C}=I("query"),c=a.get("category")||"TEACHER",u=a.get("searchType")||"title",p=o.useMemo(()=>{if(e)switch(u){case"title":return{title:e};case"content":return{content:e};case"userName":return{userName:e};default:return{title:e}}},[e,u]),{data:l,isLoading:f,hasNextPage:y,fetchNextPage:n,isFetchingNextPage:j,error:P}=U(10,c,p),g=o.useMemo(()=>{const i=(l==null?void 0:l.pages.flatMap(x=>x.content||[]))||[];return Array.from(new Map(i.map(x=>[x.id,x])).values())},[l]),v=()=>{const i=A();!i||i.includes("/search/")?r(w.COMMUNITY):r(i)},k=i=>{window.history.replaceState({fromSearch:!0,searchQuery:e,category:c,searchPath:s.pathname+s.search},"",w.COMMUNITY_POST.replace(":id",i)),r(w.COMMUNITY_POST.replace(":id",i),{replace:!0,state:{fromSearch:!0,searchQuery:e,category:c,searchPath:s.pathname+s.search}})},N=C(g);return t.jsx(L,{title:"커뮤니티 검색",placeholder:"게시물 제목으로 검색해보세요",searchValue:e,onSearchSubmit:h,onSearchClear:d,onBackButtonClick:v,children:t.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[g.length>0?t.jsx("div",{className:N?"bg-primary-foreground":"bg-white",children:t.jsx(_,{searchQuery:e,results:g,totalItems:g.length,isLoading:f,isFetchingNextPage:j,hasNextPage:y,fetchNextPage:()=>n(),error:P,onPostClick:k})}):e&&t.jsx("section",{className:"flex-1 bg-white",children:t.jsx("p",{className:"py-8 text-center text-sm text-primary-normal03",children:"검색 결과가 없습니다."})}),!m&&!N&&t.jsx("div",{className:"flex-1 bg-white",children:t.jsx(T,{onSelectQuery:S})})]})})}export{ne as default};
