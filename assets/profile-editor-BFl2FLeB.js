import{a as v,c as V,r as t,U as m,j as s,d as M}from"./index-C8JFuZlv.js";import{s as h,o as A,e as F}from"./types-CfV6Q2Fg.js";import{u as g,F as k}from"./index-D7zi7Ntn.js";import{P as T,B as d}from"./index-DR008vrG.js";import{E as L}from"./index-Bv8WoFpc.js";import{N as H,R as B}from"./RoleField-DXy1EF73.js";import{e as G,f as D}from"./useAuth-C0xK3gWt.js";import{c as I}from"./validationSchemas-CFCrOTP5.js";import"./useMetadata-D7nd75QV.js";import"./useMutation-B4GGscfX.js";import"./index-DFQufHV3.js";const O=A({role:F(["TEACHER","PROSPECTIVE_TEACHER"],{errorMap:()=>({message:"회원 유형을 선택해주세요."})})});function ee(){const n=v(),[e]=V(M),{mutate:i,isPending:u,error:f}=G(),{mutate:c,isPending:p,error:x}=D(),a=t.useMemo(()=>{const r=!(e!=null&&e.role)||e.role==="GENERAL",C=!(e!=null&&e.role)||e.role==="GENERAL"||e.role==="ADMIN"?"TEACHER":e.role,P=(e==null?void 0:e.nickname)||"";return{isNewUser:r,defaultRole:C,defaultNickname:P}},[e==null?void 0:e.role,e==null?void 0:e.nickname]),[l,E]=t.useState(()=>a.defaultRole),R=t.useMemo(()=>({resolver:h(I),mode:"onChange",reValidateMode:"onChange",defaultValues:{nickname:a.defaultNickname}}),[a.defaultNickname]),U=t.useMemo(()=>({resolver:h(O),defaultValues:{role:a.defaultRole}}),[a.defaultRole]),o=g(R),j=g(U),b=t.useCallback(r=>{i(r.nickname,{onSuccess:()=>{n(m.USER)}})},[i,n]),S=t.useCallback(()=>{c(l,{onSuccess:()=>{n(m.USER)}})},[c,l,n]),w=t.useCallback(()=>{const r=o.getValues("nickname");if(!r||r.length<2){o.setError("nickname",{type:"manual",message:"닉네임은 최소 2자 이상이어야 합니다."});return}i(r,{onSuccess:()=>{c(l,{onSuccess:()=>{n(m.HOME)}})}})},[o,i,c,l,n]),N=t.useMemo(()=>f||x,[f,x]),y=t.useMemo(()=>({title:"원바원 | 프로필",description:"사용자 프로필 수정",headerTitle:a.isNewUser?void 0:"프로필 수정",headerLogo:a.isNewUser?void 0:!0,currentPath:m.USER,wrapperBg:"white",mainClassName:a.isNewUser?"flex flex-col my-auto px-5":"flex flex-col pb-5 mb-24 mt-14 pt-8 px-5",isGlobalNavBar:!a.isNewUser}),[a.isNewUser]);return s.jsxs(T,{...y,children:[a.isNewUser&&s.jsx("section",{className:"flex flex-col",children:s.jsxs("h1",{className:"pb-16 text-center text-lg",children:["반가워요! ",s.jsx("br",{})," 선생님에 대해 알려주세요!"]})}),s.jsxs("div",{className:"flex flex-col gap-7",children:[s.jsxs("section",{children:[s.jsx("h2",{className:"sr-only",children:"닉네임 변경"}),s.jsx(k,{...o,children:s.jsxs("form",{onSubmit:o.handleSubmit(b),className:"flex flex-col gap-4",children:[s.jsx(H,{control:o.control,name:"nickname",setValue:o.setValue,label:a.isNewUser?"선생님이 사용하실 닉네임이에요!":"닉네임"}),!a.isNewUser&&s.jsx(d,{type:"submit",disabled:u||!o.formState.isValid,variant:"secondary",font:"md",children:"닉네임 변경하기"})]})})]}),s.jsxs("section",{children:[s.jsx("h2",{className:"sr-only",children:"역할 변경"}),s.jsx(k,{...j,children:s.jsxs("form",{onSubmit:r=>{r.preventDefault(),S()},className:"flex flex-col gap-4",children:[s.jsx(B,{selectedRole:l,onRoleChange:E,label:a.isNewUser?"해당되는 역할을 선택해주세요.":"역할"}),!a.isNewUser&&s.jsx(d,{type:"submit",disabled:p,variant:"secondary",font:"md",children:"역할 변경하기"})]})})]}),a.isNewUser&&s.jsx(d,{type:"button",onClick:w,disabled:u||p||!o.formState.isValid||!o.getValues("nickname"),variant:"secondary",font:"md",className:"mt-2",children:"시작하기"})]}),N&&s.jsx(L,{error:N.message})]})}export{ee as default};
