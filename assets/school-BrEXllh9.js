import{r as h,j as r,E as j,a as k,v as C,U as v}from"./index-C8JFuZlv.js";import{u as N,S as b,R as P}from"./useSearchPage-DBi74EYz.js";import{F as R}from"./index.esm-CCktejdI.js";import{S as E}from"./index-DUOfRk2D.js";import{s as L}from"./scroll.module-BdLMzxx7.js";import{u as I}from"./useSuspenseInfiniteQuery-BdZRK4nz.js";import{s as H}from"./kindergartenService-Cv6rNABr.js";import{g as z}from"./useMetadata-D7nd75QV.js";import"./index-D7zi7Ntn.js";import"./index-DFQufHV3.js";import"./index-YwY8NhB0.js";import"./infiniteQueryObserver-CmTYH24f.js";import"./useMutation-B4GGscfX.js";const M=({index:n,style:t,data:e})=>{const s=e.items[n];return r.jsx("div",{style:t,children:r.jsx("div",{onClick:()=>e.onItemClick(s.id.toString()),className:"cursor-pointer py-1",children:r.jsx(E,{id:s.id.toString(),schoolName:s.name,location:s.address,establishment:s.establishment,workReviewAggregate:s.workReviewAggregate})})})};function O({searchQuery:n,results:t,totalItems:e,isFetchingNextPage:s,hasNextPage:a,fetchNextPage:i,onKindergartenClick:o}){const[p,f]=h.useState(()=>typeof window<"u"?window.innerHeight-80:680),m=110,l=Math.min(t.length*m,p),d=Math.floor(t.length*.8);h.useEffect(()=>{const c=()=>{f(window.innerHeight-120)};return window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}},[]);const S=h.useCallback(c=>o(c),[o]),u=h.useCallback(()=>{!s&&a&&i()},[s,a,i]),x=h.useCallback(({overscanStopIndex:c,visibleStopIndex:w})=>{w>d&&c>=t.length-5&&u()},[t.length,d,u]);return n?r.jsxs("div",{className:"flex flex-col gap-2 pt-4",children:[r.jsx("div",{className:"mx-5 flex justify-between",children:r.jsxs("h3",{className:"text-sm font-semibold text-primary-dark01",children:["총 ",e>0&&`${e}`,"개의 검색 결과"]})}),r.jsx(R,{height:l,width:"100%",itemCount:t.length,itemSize:m,onItemsRendered:x,overscanCount:5,itemData:{items:t,onItemClick:S},className:L["scrollbar-hide"],children:M})]}):null}const A=n=>{var s;const t=!!n.name&&n.name.trim()!=="",e=I({queryKey:["kindergartens",n],queryFn:({pageParam:a=0})=>t?H({...n,page:a,size:10}):{content:[],pageNumber:0,totalPages:0,totalElements:0,last:!0,first:!0,pageSize:10,empty:!0},initialPageParam:0,getNextPageParam:a=>{const{pageNumber:i,totalPages:o}=a;return i<o-1?i+1:void 0}});try{const{data:a,fetchNextPage:i,hasNextPage:o,isFetchingNextPage:p,isLoading:f,isError:m,error:l}=e,d=a.pages.flatMap(u=>u.content||[]),S=((s=a.pages[0])==null?void 0:s.totalElements)||0;return{results:d,totalItems:S,fetchNextPage:i,hasNextPage:o,isFetchingNextPage:p,isLoading:f,isError:m,error:l}}catch(a){throw j({title:"유치원 검색 오류",description:a instanceof Error?a.message:"알 수 없는 오류",variant:"destructive"}),a}};function W(){const n=k(),t=C(),{searchQuery:e,isInitialRender:s,handleSearchSubmit:a,handleClearSearch:i,handleRecentSearchSelect:o,isSearchResult:p}=N("query"),[f,m]=h.useState({name:e});h.useEffect(()=>{m({name:e})},[e]);const{results:l,totalItems:d,fetchNextPage:S,hasNextPage:u,isFetchingNextPage:x}=A(f),c=()=>{const g=z();!g||g.includes("/search/")?n(v.SCHOOL):n(g)},w=g=>{window.history.replaceState({fromSearch:!0,searchQuery:e,searchPath:t.pathname+t.search},"",v.SCHOOL_DETAIL.replace(":id",g)),n(v.SCHOOL_DETAIL.replace(":id",g),{replace:!0,state:{fromSearch:!0,searchQuery:e,searchPath:t.pathname+t.search}})},y=p(l);return r.jsx(b,{title:"유치원 검색",placeholder:"유치원 이름으로 검색해보세요",searchValue:e,onSearchSubmit:a,onSearchClear:i,onBackButtonClick:c,children:r.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[l.length>0?r.jsx("div",{className:y?"bg-primary-foreground":"bg-white",children:r.jsx(O,{searchQuery:e,results:l,totalItems:d,isFetchingNextPage:x,hasNextPage:u,fetchNextPage:S,onKindergartenClick:w})}):e&&r.jsx("div",{className:"flex-1 bg-white",children:r.jsx("p",{className:"py-8 text-center text-sm text-primary-normal03",children:"검색 결과가 없습니다."})}),!s&&!y&&r.jsx("div",{className:"flex-1 bg-white",children:r.jsx(P,{onSelectQuery:o})})]})})}export{W as default};
