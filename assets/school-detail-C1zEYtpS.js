import{j as e,S as N,t as _,a as F,v as M,r as w,U as b,b as D,L as B}from"./index-C8JFuZlv.js";import{a as R,u as G}from"./useMetadata-D7nd75QV.js";import{E as H}from"./index-BJS9H4xq.js";import{P as U}from"./index-DR008vrG.js";import{N as K}from"./index-WMVJUL97.js";import{K as Y,a as W}from"./KindergartenMapMarker-BFxQ0Mnp.js";import{R as E}from"./review-IuptfKQ8.js";import{a as q}from"./kindergartenService-Cv6rNABr.js";import"./useMutation-B4GGscfX.js";const j=["#FFD700","#4CAF50","#6CA6ED"];function Q({stats:l,size:n=100}){const s=n/2,r=n*.23,i=s-r/1.3;let u=-90;const t=a=>typeof a=="number"?a:parseFloat(a.replace("%",""))||0,m=l.map(a=>({...a,percent:t(a.percent)})).filter(a=>!isNaN(a.percent)&&typeof a.percent=="number"&&!isNaN(a.count)&&typeof a.count=="number"),C=m.reduce((a,d)=>a+d.percent,0),k=C>0?100/C:1,A=m.length>3?[...m.slice(0,2),{age:0,count:m.slice(2).reduce((a,d)=>a+d.count,0),percent:m.slice(2).reduce((a,d)=>a+d.percent,0),color:j[2]}]:m.map((a,d)=>({...a,color:d<j.length?j[d]:j[0]}));return e.jsx("div",{className:"relative",style:{width:n,height:n},children:e.jsxs("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,children:[e.jsx("circle",{cx:s,cy:s,r:i,fill:"none",stroke:"#F2F4F6",strokeWidth:r}),A.map((a,d)=>{const g=a.percent*k/100*360,o=s+i*Math.cos(u*Math.PI/180),c=s+i*Math.sin(u*Math.PI/180),h=u+g,p=s+i*Math.cos(h*Math.PI/180),x=s+i*Math.sin(h*Math.PI/180),I=g>180?1:0,T=[`M ${o} ${c}`,`A ${i} ${i} 0 ${I} 1 ${p} ${x}`].join(" ");return u=h,e.jsx("path",{d:T,fill:"none",stroke:a.color||j[0],strokeWidth:r,strokeLinecap:"butt"},d)})]})})}function S({icon:l,title:n,children:s,altText:r}){return e.jsx("li",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{children:e.jsx("img",{src:l,alt:r,width:"18",height:"18"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col gap-0.5",children:[e.jsx("h3",{className:"text-sm font-medium text-primary-normal03",children:n}),typeof s=="string"?e.jsx("p",{className:"line-clamp-1 text-base font-semibold text-primary-dark02",children:s}):s]})]})})}const y=["#FFD700","#4CAF50","#6CA6ED"];function V({colorIndex:l,age:n,count:s,percent:r,unit:i}){const u={backgroundColor:y[l%y.length]};return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{style:u,className:"h-2 w-2 rounded-full"}),e.jsxs("p",{className:"text-xs text-primary-dark02",children:["만 ",n,"세 ",s,i," ",r]})]})}function L({title:l,totalCount:n,unit:s,stats:r}){const i=r.map((t,f)=>({...t,percent:typeof t.percent=="number"?t.percent:parseFloat(t.percent.replace("%",""))||0,color:y[f%y.length]})),u=s==="class"?"개 학급":"명";return e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(S,{icon:N.CLASS,title:l,altText:`${l} 아이콘`}),e.jsxs("div",{className:"flex justify-around gap-7 rounded-lg bg-primary-foreground px-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 text-primary-dark02",children:[e.jsxs("p",{className:"text-base font-semibold",children:[l==="학급"?"":"유아 ",n,s==="class"?"개 학급":"명"]}),e.jsx("div",{children:r.map((t,f)=>e.jsx(V,{colorIndex:f,age:t.age,count:t.count,percent:t.percent,unit:s==="class"?"개 학급":"명"},t.age))})]}),e.jsx(Q,{stats:i,totalCount:n,unit:u,size:100})]})]})}function X({latitude:l,longitude:n,schoolName:s,establishment:r,className:i=""}){return e.jsx(Y,{latitude:l,longitude:n,level:4,height:"h-64",className:i,showUserLocation:!1,children:e.jsx(W,{latitude:l,longitude:n,name:s,establishment:r,size:"md",showLabel:!0})})}const O={AGE_3:"bg-star",AGE_4:"bg-green",AGE_5:"bg-tertiary-3"},P=[3,4,5],$="유치원",J={staleTime:1e3*60*5,gcTime:1e3*60*30,refetchOnWindowFocus:!1};function le(){var g;const{id:l}=_(),n=F(),s=M(),r=l||"unknown",i=w.useCallback(()=>{var o;return(o=s.state)!=null&&o.fromBookmarks?(n(b.BOOKMARKS),!0):!1},[(g=s.state)==null?void 0:g.fromBookmarks,n]),{handleBackNavigation:u}=R(i),{data:t,isLoading:f,error:m}=G({queryKey:["kindergarten","detail",r],queryFn:()=>q(Number(r)),enabled:!!l&&l!=="unknown",...J}),C=[{href:`/school/${r}`,label:"기관정보"},{href:`/school/${r}/review?type=${E.WORK}`,label:"근무리뷰"},{href:`/school/${r}/review?type=${E.LEARNING}`,label:"실습리뷰"}],k=o=>{const c=o.totalClassCount;return P.map(p=>{const x=o[`classCount${p}`];return{age:p,count:x,percent:c>0?`${Math.round(x/c*100)}%`:"0%",color:O[`AGE_${p}`]}})},A=o=>{const c=o.totalPupilCount;return P.map(p=>{const x=o[`pupilCount${p}`];return{age:p,count:x,percent:c>0?`${Math.round(x/c*100)}%`:"0%",color:O[`AGE_${p}`]}})},a=o=>{const c=new Date(o);return`${c.getFullYear()}년 ${c.getMonth()+1}월 ${c.getDate()}일`},d=()=>{var o;if((o=s.state)!=null&&o.fromSearch){const{searchPath:c}=s.state;if(c)n(c);else{const{searchQuery:h}=s.state,p=`${b.SEARCH_SCHOOL}?query=${encodeURIComponent(h)}`;n(p)}}else u()},v=()=>{if(f)return e.jsx(D,{});if(m||!t)return e.jsx(H,{type:"page",children:(m==null?void 0:m.message)||"유치원 정보를 찾을 수 없습니다."});const o=k(t),c=A(t);return e.jsxs(e.Fragment,{children:[e.jsx(K,{id:r,options:C,currentPath:b.SCHOOL_DETAIL.replace(":id",r)}),e.jsx("section",{className:"px-5 py-5 pb-28",children:e.jsxs("ul",{className:"flex flex-1 flex-col gap-7",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx(S,{icon:N.LOCATION,title:"위치정보",altText:"위치 아이콘",children:e.jsx("address",{className:"text-base font-semibold not-italic text-primary-dark02",children:t.address})}),e.jsx(X,{latitude:t.latitude,longitude:t.longitude,schoolName:t.name,establishment:t.establishment})]}),e.jsx(S,{icon:N.CALL,title:"전화",altText:"전화기 아이콘",children:e.jsx("p",{className:"text-base font-semibold text-primary-dark02",children:t.phoneNumber})}),e.jsx(S,{icon:N.BUILDING,title:"설립",altText:"건물 아이콘",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("p",{className:"text-base font-semibold text-primary-dark02",children:t.establishment}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("p",{children:["설립"," ",e.jsx("span",{children:a(t.establishmentDate)})]}),e.jsxs("p",{children:["개원 ",e.jsx("span",{children:a(t.openDate)})]})]})]})}),e.jsx(L,{title:"학급",totalCount:t.totalClassCount,unit:"class",stats:o}),e.jsx(L,{title:"원생",totalCount:t.totalPupilCount,unit:"student",stats:c}),t.homepage&&e.jsx(S,{icon:N.HOMEPAGE,title:"홈페이지",altText:"홈 아이콘",children:e.jsx(B,{to:t.homepage,className:"block truncate font-semibold text-primary-dark02 hover:underline",target:"_blank",rel:"noopener noreferrer",children:t.homepage})})]})})]})};return e.jsx(U,{title:`원바원 | ${(t==null?void 0:t.name)||$} 상세정보`,description:`${(t==null?void 0:t.name)||$} 상세 정보`,headerTitle:(t==null?void 0:t.name)||$,headerType:"school",currentPath:b.SCHOOL_DETAIL.replace(":id",r),wrapperBg:"white",kindergartenId:r,showBookmark:!0,mainClassName:"flex flex-col mt-14",hasBackButton:!0,onBackButtonClick:d,children:v()})}export{le as default};
