import{r as j,j as e,S as p,z as y,a as k,U as R,t as D,v as H,b as w}from"./index-C8JFuZlv.js";import{E as z}from"./index-BJS9H4xq.js";import{B as E,P as Y}from"./index-DR008vrG.js";import{u as K}from"./index-DFoBqv4q.js";import{E as V}from"./index-Bz5g5oRx.js";import{A as C}from"./index-Dea53TQG.js";import{B as T}from"./index-YwY8NhB0.js";import{P as G,g as q}from"./getUserRoleLabel-BYsQKnzs.js";import{f as b}from"./dateUtils-Br-z8UuZ.js";import{b as Q,c as X,d as J,e as W,f as Z}from"./useCommunity-BolemDNT.js";import{A as ee}from"./index-C7UfpOvL.js";import{L as se}from"./index-pWXMOai-.js";import{g as te,C as ae}from"./categoryUtils-zncHimf5.js";import"./useMetadata-D7nd75QV.js";import"./useMutation-B4GGscfX.js";import"./useSuspenseInfiniteQuery-BdZRK4nz.js";import"./infiniteQueryObserver-CmTYH24f.js";import"./query-config-BQJB0S96.js";import"./index-bz4f2k9Y.js";function re({replyParentId:s,replyUserName:t,onCancelReply:a,onSubmit:n,value:i,onChange:r}){const[x,o]=j.useState(!1),h=()=>{a&&a()},f=()=>{i.trim()&&n(i,s)},u=m=>{r&&r(m.target.value)},l=m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),f())};return e.jsx("div",{className:"fixed bottom-0 mx-auto flex w-full min-w-80 max-w-3xl items-center justify-between border-t border-opacity-5 bg-white px-5 pb-3 pt-2 text-xs transition-all duration-200",children:e.jsxs("div",{className:"flex w-full flex-col",children:[t&&e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-primary-dark01",children:[e.jsx("span",{className:"text-tertiary-3",children:t}),"님에게 답글 남기는 중"]}),e.jsx("button",{type:"button",onClick:h,className:"opacity-50",children:e.jsx("img",{src:p.CANCEL,alt:"X 아이콘",width:20,height:20})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("textarea",{value:i,onChange:u,onKeyDown:l,placeholder:"댓글을 입력해주세요.",className:y("flex w-full flex-1 resize-none rounded-lg bg-primary-foreground px-4 py-2.5 text-sm outline-none transition-all duration-200",x?"h-24":"h-10"),onFocus:()=>o(!0),onBlur:()=>o(!1)}),e.jsx(E,{type:"button",variant:"secondary",className:"absolute bottom-5 right-7 self-end px-2 py-1",onClick:f,children:"등록"})]})]})})}function L({reply:s,postAuthor:t}){const a=t===s.nickName;return e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(G,{role:s.userRole,size:"sm"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex items-center gap-1.5",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm font-semibold text-primary-dark02",children:s.nickName}),a&&e.jsx(T,{children:"작성자"})]})}),e.jsxs("ul",{className:"flex gap-1.5 text-xs text-primary-normal03",children:[s.career&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:s.career}),e.jsx("li",{"aria-hidden":"true",children:"·"})]}),e.jsx("li",{children:q(s.userRole)})]})]})]})}function ne({className:s,onClick:t}){return e.jsxs(E,{font:"xs_sb",size:"xs",variant:"transparent_gray",border:"gray",className:y(s,"gap-0.5"),onClick:t,children:[e.jsx("img",{src:p.REPLY,alt:"답변 아이콘",width:20,height:20}),"답글"]})}function ie({comment:s,postAuthor:t,postId:a,onReply:n}){const{nickName:i,createdAt:r,content:x}=s,o=()=>{n(i)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border-b px-4 py-5",children:[e.jsxs("div",{className:"flex flex-1 justify-between",children:[e.jsx(L,{reply:s,postAuthor:t}),e.jsx(C,{targetId:s.id,targetType:"COMMENT",authorNickname:i,postId:a})]}),e.jsx("p",{className:"mb-3 mt-2 text-sm text-primary-dark01",children:x}),e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("span",{className:"text-xxs text-primary-normal03",children:b(r)}),e.jsx(ne,{onClick:o})]})]})})}function le({reply:s,postAuthor:t,postId:a}){return e.jsx("div",{className:"border-b px-4 py-5",children:e.jsxs("div",{className:"flex flex-1 items-start gap-2.5",children:[e.jsx("img",{src:p.BROKEN_LINE,alt:"꺾은 선 아이콘",width:15,height:16}),e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(L,{reply:s,postAuthor:t}),e.jsx(C,{targetId:s.id,targetType:"COMMENT",authorNickname:s.nickName,postId:a})]}),e.jsx("p",{className:"whitespace-pre-wrap text-sm text-primary-dark01",children:s.content}),e.jsx("p",{className:"text-xxs text-primary-normal03",children:b(s.createdAt)})]})]})})}function ce({postId:s,post:t,handleReply:a}){const{ref:n,inView:i}=K({threshold:.1,triggerOnce:!1}),{data:r,fetchNextPage:x,hasNextPage:o,isFetchingNextPage:h}=Q({postId:s,size:10});j.useEffect(()=>{i&&o&&!h&&x()},[i,o,h,x]);const f=r==null?void 0:r.pages.some(u=>u.content.length>0);return e.jsx("section",{className:"flex flex-1 flex-col bg-white",children:f?e.jsxs(e.Fragment,{children:[r.pages.map(u=>u.content.map(l=>e.jsx("div",{children:l.reply?e.jsx(le,{reply:l,postAuthor:t.userNickname,postId:s}):e.jsx(ie,{comment:l,postAuthor:t.userNickname,postId:s,onReply:()=>a(l.nickName,l.id)})},l.id))),o&&e.jsx("div",{ref:n,className:"flex h-1 w-full justify-center",children:h&&null})]}):e.jsx(V,{className:"my-auto",title:"댓글이 없습니다.",subTitle:"게시물에 첫 댓글을 남겨보세요!"})})}function oe({count:s,className:t}){return e.jsxs("div",{className:y("flex items-center justify-center gap-1 text-xs font-semibold text-primary-normal03",t),children:[e.jsx("img",{src:p.CHAT.line,alt:"말풍선 아이콘",width:20,height:20}),e.jsx("span",{children:"댓글"}),s!==void 0&&e.jsx("span",{className:"-ml-1",children:`(${s})`})]})}function xe({post:s,likeStatus:t,commentsCount:a,isLiking:n,handleLikeToggle:i}){const r=k(),x=()=>{r(R.COMMUNITY)};return e.jsxs("article",{className:"flex flex-col gap-7 bg-white px-5 pb-4 pt-7",children:[e.jsxs("section",{className:"flex flex-col gap-2.5",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{children:te(s.categoryName)})}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"relative h-7 w-7 rounded-full bg-primary-normal03",children:e.jsx("img",{src:p.CHARACTER.user,alt:"병아리 사용자 캐릭터",className:"absolute left-1/2 top-1/2 h-3/5 w-2/3 -translate-x-1/2 -translate-y-1/2"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-primary-dark02",children:s.userNickname}),e.jsxs("ul",{className:"flex gap-1 text-xxs text-primary-normal03",children:[s.userRole==="PROSPECTIVE_TEACHER"?null:e.jsxs(e.Fragment,{children:[e.jsx("li",{children:s.career===null&&s.userRole==="TEACHER"?"비공개":s.career}),e.jsx("li",{"aria-hidden":"true",children:" · "})]}),e.jsx("li",{children:ae[s.userRole]})]})]})]}),e.jsx(C,{targetId:s.id,targetType:"POST",authorNickname:s.userNickname,onDeleteSuccess:x})]})]}),e.jsxs("section",{className:"flex flex-col gap-4 text-primary-dark01",children:[e.jsxs("div",{className:"flex flex-col gap-2.5",children:[e.jsx("h2",{className:"font-semibold",children:s.title}),e.jsx("p",{className:"text-sm",children:s.content})]}),e.jsxs("ul",{className:"flex justify-end gap-1 text-xxs text-primary-normal03",children:[e.jsx("li",{children:b(s.createdAt)}),e.jsx("li",{"aria-hidden":"true",children:" · "}),e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx("img",{src:p.EYE.on,alt:"눈 아이콘",width:15,height:15}),e.jsx("span",{children:s.viewCount})]})]}),e.jsx(ee,{children:"비속어 및 특정 인물에 대한 명예훼손으로 간주되는 내용이 포함될 경우 삭제될 수 있습니다."})]}),e.jsxs("section",{className:"flex justify-between",children:[e.jsx(oe,{count:a!==void 0?a:s.commentCount,className:"w-1/2"}),e.jsx(se,{count:(t==null?void 0:t.likeCount)||0,onToggle:i,disabled:n,isLiked:(t==null?void 0:t.liked)||!1,className:"w-1/2",children:"좋아요"})]})]})}function Ae(){const{id:s}=D(),t=k(),a=H(),n=s?Number(s):0,[i,r]=j.useState(void 0),[x,o]=j.useState(void 0),[h,f]=j.useState(!1),[u,l]=j.useState(""),{data:m,isLoading:A}=X(n),{data:N,refetch:P}=J(n),B=W(),I=Z(),c=m==null?void 0:m.data,S=()=>{var d;if((d=a.state)!=null&&d.fromSearch){const{searchPath:g}=a.state;if(g)t(g);else{const{searchQuery:_,category:v}=a.state,$=`${R.SEARCH_COMMUNITY}?query=${encodeURIComponent(_)}${v?`&category=${v}`:""}`;t($)}}else t(-1)},M=async()=>{h||!s||(f(!0),await I.mutateAsync(n),P(),f(!1))},F=async(d,g)=>{!s||!d.trim()||(await B.mutateAsync({postId:n,content:d,parentId:g}),l(""),r(void 0),o(void 0))},O=(d,g)=>{r(d),o(g),l("")},U=()=>{r(void 0),o(void 0),l("")};return e.jsx(Y,{isGlobalNavBar:!1,title:`원바원 | ${(c==null?void 0:c.title)||"게시글"}`,description:`원바원 커뮤니티 게시글 - ${(c==null?void 0:c.title)||""}`,headerTitle:(c==null?void 0:c.title)||"게시글",currentPath:`/community/${s}`,mainBg:"gray",mainClassName:"flex flex-1 flex-col gap-2 mb-16 mt-14",hasBackButton:!0,onBackButtonClick:S,children:A?e.jsx(w,{}):c?e.jsxs(e.Fragment,{children:[e.jsx(xe,{post:c,likeStatus:N==null?void 0:N.data,commentsCount:c.commentCount,isLiking:h,handleLikeToggle:M}),e.jsx(j.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(ce,{postId:n,post:c,handleReply:O})}),e.jsx(re,{replyParentId:x,replyUserName:i,onCancelReply:U,onSubmit:F,value:u,onChange:d=>l(d)})]}):e.jsx(z,{type:"page",children:"게시글을 찾을 수 없습니다."})})}export{Ae as default};
