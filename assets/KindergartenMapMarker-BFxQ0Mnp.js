var M=Object.defineProperty;var I=(r,e,t)=>e in r?M(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e,t)=>I(r,typeof e!="symbol"?e+"":e,t);import{r as l,R as w,w as S,j as i,S as v}from"./index-C8JFuZlv.js";import{B as N}from"./index-DR008vrG.js";const j=r=>{const e=r==null?void 0:r.includes("공립"),t=r==null?void 0:r.includes("사립");return e?{bgColor:"#6CA6ED",borderColor:"transparent",textColor:"white",text:"공립",showIcon:!1}:t?{bgColor:"white",borderColor:"#6CA6ED",textColor:"#6CA6ED",text:"사립",showIcon:!1}:{bgColor:"#6b7280",borderColor:"transparent",textColor:"white",text:"미확인",showIcon:!1}},q=(r,e=[])=>{if(e.length===0)return 6;const t=[r.latitude,...e.map(a=>a.latitude)],s=[r.longitude,...e.map(a=>a.longitude)],o=Math.max(...t)-Math.min(...t),d=Math.max(...s)-Math.min(...s),u=Math.max(o,d);return u>.3?9:u>.2?8:u>.1?7:6},A=typeof window<"u"&&typeof document<"u"?l.useLayoutEffect:l.useEffect,L="__react-kakao-maps-sdk__";let m=function(r){return r[r.INITIALIZED=0]="INITIALIZED",r[r.LOADING=1]="LOADING",r[r.SUCCESS=2]="SUCCESS",r[r.FAILURE=3]="FAILURE",r}({});const O=`${L}_Loader`,n=class n{constructor(e){p(this,"callbacks",[]);p(this,"done",!1);p(this,"loading",!1);p(this,"errors",[]);let{appkey:t,id:s=O,libraries:o=[],nonce:d,retries:u=3,url:a="//dapi.kakao.com/v2/maps/sdk.js"}=e;if(this.id=s,this.appkey=t,this.libraries=o,this.nonce=d,this.retries=u,this.url=a,n.instance&&!n.equalOptions(this.options,n.instance.options)&&!n.equalOptions(this.options,n.instance.options))switch(n.instance.status){case m.FAILURE:throw new Error(`Loader must not be called again with different options. 
${JSON.stringify(this.options,null,2)}
!==
${JSON.stringify(n.instance.options,null,2)}`);default:n.instance.reset(),n.instance=this;break}return n.instance||(n.instance=this),n.instance}get options(){return{appkey:this.appkey,id:this.id,libraries:this.libraries,nonce:this.nonce,retries:this.retries,url:this.url}}static addLoadEventLisnter(e){return window.kakao&&window.kakao.maps&&window.kakao.maps.load(e),n.loadEventCallback.add(e),e}static removeLoadEventLisnter(e){return n.loadEventCallback.delete(e)}load(){return new Promise((e,t)=>{this.loadCallback(s=>{s?t(s):e(window.kakao)})})}get status(){return this.onEvent?m.FAILURE:this.done?m.SUCCESS:this.loading?m.LOADING:m.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}loadCallback(e){this.callbacks.push(e),this.execute()}resetIfRetryingFailed(){this.failed&&this.reset()}reset(){this.deleteScript(),this.done=!0,this.loading=!1,this.errors=[],this.onEvent=void 0}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.kakao&&window.kakao.maps){console.warn("Kakao Maps이 이미 외부 요소에 의해 로딩되어 있습니다.설정한 옵션과 일치 하지 않을 수 있으며, 이에 따른 예상치 동작이 발생할 수 있습니다."),window.kakao.maps.load(this.callback);return}this.loading||(this.loading=!0,this.setScript())}}setScript(){document.getElementById(this.id)&&this.callback();const e=this.createUrl(),t=document.createElement("script");t.id=this.id,t.type="text/javascript",t.src=e,t.onerror=this.loadErrorCallback.bind(this),t.onload=this.callback.bind(this),t.defer=!0,t.async=!0,this.nonce&&(t.nonce=this.nonce),document.head.appendChild(t)}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const t=this.errors.length*2**this.errors.length;console.log(`Failed to load Kakao Maps script, retrying in ${t} ms.`),setTimeout(()=>{this.deleteScript(),this.setScript()},t)}else this.done=!0,this.loading=!1,this.onEvent=this.errors[this.errors.length-1],this.callbacks.forEach(t=>{t(this.onEvent)}),this.callbacks=[],n.loadEventCallback.forEach(t=>{t(this.onEvent)})}createUrl(){let e=this.url;return e+=`?appkey=${this.appkey}`,this.libraries.length&&(e+=`&libraries=${this.libraries.join(",")}`),e+="&autoload=false",e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}callback(){kakao.maps.load(()=>{n.instance.done=!0,n.instance.loading=!1,n.instance.callbacks.forEach(e=>{e(n.instance.onEvent)}),n.instance.callbacks=[],n.loadEventCallback.forEach(e=>{e(n.instance.onEvent)})})}static equalOptions(e,t){if(e.appkey!==t.appkey||e.id!==t.id||e.libraries.length!==t.libraries.length)return!1;for(let s=0;s<e.libraries.length;++s)if(e.libraries[s]!==t.libraries[s])return!1;return!(e.nonce!==t.nonce||e.retries!==t.retries||e.url!==t.url)}};p(n,"loadEventCallback",new Set);let b=n;const y=function(r,e){for(var t=arguments.length,s=new Array(t>2?t-2:0),o=2;o<t;o++)s[o-2]=arguments[o];A(()=>{!r||s.every(d=>typeof d>"u")||r[e].call(r,...s)},[r,e,...s])},$=w.createContext(void 0),z=r=>{const e=l.useContext($);if(!e)throw new Error(`${r+" Component"} must exist inside Map Component!`);return e},D=w.createContext(void 0),U=w.forwardRef(function(e,t){let{position:s,children:o,clickable:d,xAnchor:u,yAnchor:a,zIndex:x,onCreate:h}=e;const f=l.useContext(D),k=z("CustomOverlayMap"),g=l.useMemo(()=>new kakao.maps.LatLng(s.lat,s.lng),[s.lat,s.lng]),c=l.useMemo(()=>{const E=document.createElement("div");return E.style.display="none",new kakao.maps.CustomOverlay({clickable:d,xAnchor:u,yAnchor:a,zIndex:x,position:g,content:E})},[d,u,a]),C=l.useMemo(()=>c.getContent(),[c]);return l.useImperativeHandle(t,()=>c,[c]),l.useLayoutEffect(()=>{if(k)return f?f.addMarker(c,!0):c.setMap(k),()=>{f?f.removeMarker(c,!0):c.setMap(null)}},[k,f,c]),l.useLayoutEffect(()=>{h&&h(c)},[c,h]),y(c,"setPosition",g),y(c,"setZIndex",x),C.parentElement&&S.createPortal(o,C.parentElement)}),R=r=>{const[e,t]=l.useState([!0,void 0]);return l.useEffect(()=>{new b({...r}).load().then(()=>t([!1,void 0])).catch(s=>{t([!1,s])})},[JSON.stringify(r)]),e};function K({height:r,latitude:e,longitude:t,mapError:s}){return i.jsxs("div",{className:`${r} to-green-100 flex w-full flex-col items-center justify-center gap-6 rounded-lg border border-primary-normal01 bg-gradient-to-br from-blue-100 p-4`,children:[i.jsxs("div",{className:"text-center",children:[i.jsx("img",{src:v.LOCATION,alt:"위치",className:"mx-auto mb-2 h-6 w-6"}),i.jsx("p",{className:"mb-2 text-sm font-medium text-primary-dark02",children:"현재 위치"}),i.jsxs("p",{className:"text-xs text-primary-normal03",children:["위도: ",e.toFixed(6)]}),i.jsxs("p",{className:"text-xs text-primary-normal03",children:["경도: ",t.toFixed(6)]})]}),i.jsxs("div",{className:"flex w-full flex-col gap-3 rounded-lg bg-white p-3 text-center opacity-80",children:[i.jsxs("p",{className:"text-xs font-medium text-red-600",children:["⚠️ ",s]}),i.jsx(N,{onClick:()=>{const o=`https://www.google.com/maps?q=${e},${t}`;window.open(o,"_blank")},variant:"secondary",size:"md",font:"xs",children:"구글맵에서 보기"})]})]})}function B({latitude:r,longitude:e,level:t=6,height:s="h-72",className:o="",showUserLocation:d=!1,children:u}){const[a,x]=l.useState(!0),[h,f]=l.useState(null),[k,g]=R({appkey:"",libraries:["services","clusterer","drawing"]});return i.jsx(K,{height:s,latitude:r,longitude:e,mapError:"카카오맵 키가 설정되지 않았습니다"})}function W({latitude:r,longitude:e,name:t,establishment:s,onClick:o,size:d="md",showLabel:u=!0}){const a=j(s),h={sm:{markerSize:"w-6 h-6",textSize:"text-xs",labelSize:"text-xs",labelPadding:"p-0.5",labelMaxWidth:"max-w-20"},md:{markerSize:"w-8 h-8",textSize:"text-xs",labelSize:"text-xs",labelPadding:"p-0.5",labelMaxWidth:"max-w-24"},lg:{markerSize:"w-10 h-10",textSize:"text-sm",labelSize:"text-sm",labelPadding:"px-2 py-1",labelMaxWidth:"max-w-32"}}[d];return i.jsx(U,{position:{lat:r,lng:e},yAnchor:1,children:i.jsxs("div",{className:`flex transform flex-col items-center transition-transform hover:scale-110 ${o?"cursor-pointer":""}`,onClick:o,title:`${t} (${s||"기타"})`,children:[i.jsx("div",{className:`${h.markerSize} flex items-center justify-center rounded-full border-2 shadow-xl`,style:{backgroundColor:a.bgColor,borderColor:a.borderColor,color:a.textColor},children:a.showIcon?i.jsx("img",{src:v.SCHOOL.active,alt:s||"유치원",className:"h-4 w-4 invert"}):i.jsx("span",{className:`${h.textSize} font-semibold`,children:a.text})}),i.jsx("div",{className:"h-0 w-0 border-l-2 border-r-2 border-t-4 border-transparent",style:{borderTopColor:a.showIcon||a.borderColor==="transparent"?a.bgColor:a.borderColor}}),u&&i.jsx("div",{className:`bg-white opacity-90 ${h.labelPadding} rounded shadow-md ${h.labelSize} mt-0.5 font-semibold ${h.labelMaxWidth} truncate`,children:t})]})})}export{B as K,W as a,q as c};
