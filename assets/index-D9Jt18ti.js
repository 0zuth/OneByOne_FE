import{j as r,x as v,r as h,y as k,z as w,A as N,d as C,t as y,b as S,a as T}from"./index-C8JFuZlv.js";import{P as E}from"./index-Bn_EOjrQ.js";import{P as L}from"./index-DR008vrG.js";import{N as A}from"./index-WMVJUL97.js";import{T as P}from"./index-bz4f2k9Y.js";import{E as I}from"./index-Bz5g5oRx.js";import{A as $}from"./index-Dea53TQG.js";import{L as O}from"./index-pWXMOai-.js";import{B as K,l as B,a as W,u as D}from"./useReview-BA00Z3nI.js";import{R as u,a as g}from"./review-IuptfKQ8.js";import{R as _,g as F,a as G,S as H}from"./reviewUtils-h8QJmf0I.js";import{u as q}from"./useMutation-B4GGscfX.js";import{u as U,s as V}from"./useMetadata-D7nd75QV.js";import{b as z}from"./kindergartenService-Cv6rNABr.js";import"./useCommunity-BolemDNT.js";import"./useSuspenseInfiniteQuery-BdZRK4nz.js";import"./infiniteQueryObserver-CmTYH24f.js";import"./query-config-BQJB0S96.js";import"./dateUtils-Br-z8UuZ.js";function M({likeCount:e,onLike:s,isLiked:t}){return r.jsx("div",{className:"flex gap-2",children:r.jsx(O,{variant:"secondary",size:"sm",isCount:!0,count:e,onToggle:s,isLiked:t,children:"도움돼요"})})}function Q({review:e,type:s,fieldConfigs:t,isExpanded:a,onToggleExpand:l}){const c=(o,n=40)=>o.length<=n?o:o.slice(0,n)+" …",i=o=>{if(s===u.WORK&&"workReviewId"in e){const n=e;switch(o){case"welfare":return{score:n.benefitAndSalaryScore,content:n.benefitAndSalaryComment||""};case"workLabel":return{score:n.workLifeBalanceScore,content:n.workLifeBalanceComment||""};case"atmosphere":return{score:n.workEnvironmentScore,content:n.workEnvironmentComment||""};case"manager":return{score:n.managerScore,content:n.managerComment||""};case"customer":return{score:n.customerScore,content:n.customerComment||""};default:return{score:0,content:""}}}else if("internshipReviewId"in e){const n=e;switch(o){case"atmosphere":return{score:n.workEnvironmentScore,content:n.workEnvironmentComment||""};case"studyHelp":return{score:n.learningSupportScore,content:n.learningSupportComment||""};case"teacherGuide":return{score:n.instructionTeacherScore,content:n.instructionTeacherComment||""};default:return{score:0,content:""}}}return{score:0,content:""}};return r.jsxs(r.Fragment,{children:[r.jsx("ul",{className:"flex flex-col gap-3",children:t.map(o=>{const{score:n,content:m}=i(o.key);return r.jsxs("li",{className:"flex flex-col gap-1.5 text-xs",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("h3",{className:"w-14 font-semibold",children:o.label}),r.jsx(K,{value:n,size:"xs",className:"gap-0.5"})]}),r.jsx("p",{className:a?"":"line-clamp-1",children:a?m:c(m)})]},o.key)})}),r.jsx("button",{onClick:l,className:"text-left text-xs font-semibold text-primary-normal03 underline",children:a?"접기":"더보기"})]})}function Y(e,s){const t=v(),a=e===u.WORK?"workReviews":"internshipReviews",{mutate:l,isPending:c}=q({mutationFn:()=>e===u.WORK?B(s):W(s),onSuccess:()=>{t.invalidateQueries({queryKey:[a]})}});return{handleLike:l,isPending:c,isLiked:(()=>{const o=t.getQueryData([a]);if(!(o!=null&&o.content))return!1;const n=o.content.find(m=>e===u.WORK?m.workReviewId===s:m.internshipReviewId===s);return n&&n.isLiked||!1})()}}function R({review:e,fieldConfigs:s,type:t}){const[a,l]=h.useState(!1),{handleLike:c,isPending:i,isLiked:o}=Y(t,"workReviewId"in e?e.workReviewId:e.internshipReviewId);return r.jsxs("div",{className:"flex flex-col gap-7",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsx(_,{rating:G(e,t),title:e.oneLineComment,workType:e.workType,createdAt:e.createdAt||"",workYear:F(e,t)}),r.jsx($,{targetId:"workReviewId"in e?e.workReviewId:e.internshipReviewId,targetType:"REVIEW"})]}),r.jsx(Q,{review:e,type:t,fieldConfigs:s,isExpanded:a,onToggleExpand:()=>l(!a)}),r.jsx("div",{className:"flex justify-end",children:r.jsx(M,{likeCount:e.likeCount||0,onLike:c,isPending:i,isLiked:o})})]})}function J({review:e,fieldConfigs:s,type:t}){return r.jsx("div",{className:"flex flex-col gap-8",children:Array.isArray(e)?e.map(a=>r.jsx(R,{review:a,fieldConfigs:s,type:t},"workReviewId"in a?a.workReviewId:a.internshipReviewId)):r.jsx(R,{review:e,fieldConfigs:s,type:t})})}var f=(e=>(e.LATEST="LATEST",e.POPULAR="POPULAR",e))(f||{});const X=[{type:f.POPULAR,label:"추천순"},{type:f.LATEST,label:"최신순"}];function Z({reviews:e,fieldConfigs:s,kindergartenName:t,initialSortType:a=f.LATEST}){const[l,c]=k(),i=l.get("type")||u.WORK,o=l.get("sortType")||a,n=d=>{c(x=>{const p=new URLSearchParams(x);return p.set("sortType",d),p})},m=e;return r.jsxs("section",{className:"mb-16 mt-2 flex flex-col gap-5 border-b border-b-primary-normal01 bg-white px-5 py-4",children:[r.jsx("div",{className:"flex justify-between border-b border-b-primary-normal01 pb-4",children:r.jsx("div",{className:"flex items-center gap-2.5",children:X.map(({type:d,label:x})=>r.jsxs(P,{size:"sm",onClick:()=>n(d),children:[r.jsx("div",{className:w("h-2 w-2 rounded-full",{"bg-star text-primary":o===d,"bg-primary-normal03":o!==d})}),r.jsx("span",{className:w("text-xs font-semibold",{"text-primary":o===d,"text-primary-normal03":o!==d}),children:x})]},d))})}),m.length>0?r.jsx(J,{review:m,fieldConfigs:s,type:i}):r.jsx(I,{title:"리뷰가 없습니다.",subTitle:`${t}의 첫 리뷰를 남겨보세요!`})]})}const ee="_progressBar_xrl8q_1",re={progressBar:ee};function se({value:e,max:s=5,className:t}){return r.jsx("progress",{value:e,max:s,className:`${re.progressBar} ${t}`})}function te({total:e,scoreData:s,fieldConfigs:t}){return r.jsxs("div",{className:"mx-auto flex w-full items-center justify-center gap-6 rounded-lg bg-primary-foreground px-2 py-4",children:[r.jsxs("div",{className:"flex flex-col items-center justify-center",children:[r.jsx("p",{className:"text-3xl font-bold",children:Number(e).toFixed(1)}),r.jsx(H,{value:e})]}),r.jsx("hr",{className:"h-20 w-px bg-primary-normal01"}),r.jsx("ul",{className:"flex w-1/2 flex-col text-xs font-semibold",children:t.map(a=>{const l=s[a.key]||0;return r.jsxs("li",{className:"flex flex-1 text-primary-normal02",children:[r.jsx("p",{className:"w-24",children:a.label}),r.jsxs("div",{className:"flex w-full items-center gap-3",children:[r.jsx(se,{value:l,className:"w-full py-0.5"}),r.jsx("span",{children:Number(l).toFixed(1)})]})]},a.key)})})]})}function ne({reviewCount:e,totalRating:s,scoreData:t,fieldConfigs:a}){return r.jsx("section",{className:"flex flex-col gap-3 bg-white px-5 pb-5 pt-6",children:r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs("div",{className:"flex gap-1 text-lg font-bold",children:[r.jsx("p",{children:"리뷰"}),r.jsx("span",{className:"text-tertiary-3",children:e})]}),r.jsx(te,{total:s,scoreData:t,fieldConfigs:a})]})})}const b=e=>U({queryKey:["kindergarten","name",e],queryFn:()=>z(Number(e)),enabled:!!e&&e!=="unknown"});function ae(e){return{schoolOptions:[{href:`/school/${e}`,label:"기관정보"},{href:`/school/${e}/review?type=${u.WORK}`,label:g[u.WORK]},{href:`/school/${e}/review?type=${u.LEARNING}`,label:g[u.LEARNING]}]}}const oe=[{key:"welfare",label:"복지/급여"},{key:"workLabel",label:"워라벨"},{key:"atmosphere",label:"분위기"},{key:"manager",label:"관리자"},{key:"customer",label:"고객"}],ie=[{key:"welfare",label:"복지/급여"},{key:"workLabel",label:"워라벨"},{key:"atmosphere",label:"분위기"},{key:"manager",label:"관리자"},{key:"customer",label:"고객"}],le=[{key:"atmosphere",label:"분위기"},{key:"studyHelp",label:"학습 도움"},{key:"teacherGuide",label:"지도 교사"}],ce=[{key:"atmosphere",label:"분위기"},{key:"studyHelp",label:"학습 도움"},{key:"teacherGuide",label:"지도 교사"}];function me(e){return e===u.WORK?{rating:oe,review:ie}:{rating:le,review:ce}}function ue(e,s,t){const{schoolOptions:a}=ae(e),l=me(s),c=D(e,s,t),i=N(C);h.useEffect(()=>{V({path:`/school/${e}/review?type=${s}`,type:s})},[e,s]);const o=()=>i?s===u.LEARNING?!(i.role==="TEACHER"||i.role==="PROSPECTIVE_TEACHER"||i.role==="ADMIN"):s===u.WORK?!(i.role==="TEACHER"||i.role==="ADMIN"):!0:!0;return{schoolOptions:a,fieldConfigs:l,reviewData:c,pageTitle:`원바원 | ${e} ${g[s]}`,currentPath:`/school/${e}/review?type=${s}`,isDisabled:o()}}const j="유치원";function de(){const{id:e}=y(),[s]=k(),t=s.get("type")||u.WORK,a=s.get("sortType")||f.LATEST,l=T(),c=e||"unknown",{data:i}=b(c),{schoolOptions:o,fieldConfigs:n,reviewData:m,currentPath:d,isDisabled:x}=ue(c,t,a),p=(i==null?void 0:i.name)||j;return r.jsxs(r.Fragment,{children:[r.jsx(A,{id:c,options:o,currentPath:d}),r.jsx(ne,{reviewCount:m.reviews.length,totalRating:m.rating.total,scoreData:m.scores,fieldConfigs:n.rating}),r.jsx(Z,{reviews:m.reviews,fieldConfigs:n.review,kindergartenName:p,initialSortType:a}),r.jsx(E,{onClick:()=>l(`/school/${c}/review/new?type=${t}`),label:"리뷰쓰기",isDisabled:x})]})}function Pe(){const{id:e}=y(),s=e||"unknown",{data:t}=b(s),a=(t==null?void 0:t.name)||j;return r.jsx(L,{title:`원바원 | ${s} 유치원`,headerTitle:a,headerType:"school",currentPath:`/school/${s}/review`,kindergartenId:s,showBookmark:!0,mainBg:"gray",mainClassName:"gap-0 mt-14 mb-28",children:r.jsx(h.Suspense,{fallback:r.jsx(S,{}),children:r.jsx(de,{})})})}export{Pe as default};
